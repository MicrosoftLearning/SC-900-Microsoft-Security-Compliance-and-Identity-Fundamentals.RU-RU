<!---
---
Демонстрация. Заголовок: "Группы безопасности сети Azure (NSG)" Схема обучения/Модуль/Урок: "Схема обучения. Описание возможностей решений безопасности Майкрософт; Модуль 1. Описание основных возможностей обеспечения безопасности в Azure; Урок 6. Описание групп безопасности сети Azure"
---
--->

# Ролик. Группы безопасности сетей Azure (NSGs)

Эта демонстрация выполняется на основе следующего содержимого Learn:

- Схема обучения. Описание возможностей решений безопасности Майкрософт
- Модуль. Описание основных возможностей обеспечения безопасности в Azure
- Урок. Описание групп безопасности сети Azure

## Сценарий демонстрации

В этой демонстрации вы изучите работу групп безопасности сети в Azure и примените группу безопасности сети к предварительно созданной виртуальной машине. Сначала вы кратко продемонстрируете сведения о виртуальной машине, которая была предварительно создана авторизованным поставщиком размещения практических занятий (ALH). Затем, используя группу безопасности сети, настроенную в рамках предварительной демонстрации, вы увидите основные параметры NSG, а также правила для входящего и исходящего трафика по умолчанию. Вы назначите интерфейс виртуальной машины группе безопасности сети, создадите новое правило RDP, чтобы разрешить подключение к виртуальной машине, и, наконец, протестируете его.

### Демонстрация, часть 1.

В этой части вы просмотрите некоторые параметры, связанные с виртуальной машиной, которая была создана в рамках демонстрации установки (DEMO_00_pre_demo_setup.md).

1. Откройте Microsoft Edge.  В адресной строке введите и войдите **https://portal.azure.com** с учетными данными Azure, предоставленными авторизованным организатором лаборатории (ALH).  Откроется домашняя страница служб Azure.

1. В синем поле поиска в верхней части страницы введите **Виртуальные машины** затем выберите **Виртуальные машины** в результатах поиска.

1. На странице «Виртуальные машины» выберите **SC900-WinVM**.  Эта виртуальная машина должна была быть создана в рамках предварительной демонстрационной настройки.  Если его нет в списке, создайте его сейчас.

1. Вы попадете на страницу SC900-WinVM.  Обратите внимание на некоторые основные сведения о виртуальной машине.

1. На панели навигации слева выберите **Сеть**.  
    1. По умолчанию используется представление для правил входящего порта.  Обратите внимание, что в сетевом интерфейсе этой виртуальной машины не настроены группы безопасности сети.  То же справедливо и при выборе правил исходящего порта.
    1. Выберите **Действующие правила безопасности** рядом с пунктом «Сетевой интерфейс».  Обратите внимание, что отображается сообщение «Нет групп безопасности сети или групп безопасности приложений, связанных с сетевым интерфейсом».

1. Обратите внимание на то, что если вы попытаетесь проверка состояние порта на странице подключения, вы получите сообщение "Не удается проверить".  Это не обязательно означает, что порты не предоставляются.  Как вы заметите, при выполнении того же действия с назначенной NSG вы получаете сообщение "Недоступно", указывающее, что трафик на этом порте заблокирован.


1. Не закрывайте эту вкладку браузера.

### Демонстрация, часть 2.

В этой части вы назначите интерфейс группе безопасности сети, а также поговорите с правилами для входящего и исходящего трафика по умолчанию, показывающими, как они работают.  В рамках настройки перед демонстрацией виртуальная машина должна назначить сетевой интерфейс виртуальной машины этой группе безопасности сети и создать новое правило для входящего трафика RDP.

1. Откройте новую вкладку браузера для портал Azure (portal.azure.com) и в синей строке поиска в верхней части страницы введите **Группы безопасности сети**. В списке результатов выберите **Группы безопасности сети** (не выбирайте «Классические группы безопасности сети»).

1. Выберите группу безопасности сети, созданную в рамках настройки предварительной демонстрации. Если вы не создавали его ранее, сделайте это сейчас. Выберите **Создать группу безопасности сети** и укажите следующие параметры:
    1. Подписка: оставьте значение по умолчанию (это подписка Azure, предоставляемая авторизованным поставщиком размещения практических занятий).
    1. Группа ресурсов:  **LabsSC900** (та же группа ресурсов, используемая виртуальной машиной).
    1. Имя:  **NSG-SC900**
    1. Регион: оставьте значение по умолчанию.
    1. Выберите **Проверить и создать**, затем выберите **Создать**.
    1. После завершения развертывания (это происходит очень быстро), выберите **Перейти к ресурсу**.

1. В верхней части страницы под надписью «Основное» вы увидите некоторые основные сведения о созданной группе безопасности сети.  Следует отметить 2 момента: отсутствуют настраиваемые правила безопасности, и отсутствуют подсети и сетевые интерфейсы, связанные с этой группой безопасности сети.  Несмотря на отсутствие настраиваемых правил безопасности, существуют правила для входящего и исходящего трафика по умолчанию, которые включены в каждую группу безопасности сети, как показано на странице.  Просмотрите правила для входящего и исходящего трафика. Правила для входящего трафика по умолчанию запрещают весь входящий трафик, который поступает не из виртуальной сети или подсистемы балансировки нагрузки Azure.  Правила для исходящего трафика запрещают весь исходящий трафик, кроме трафика между виртуальными сетями и исходящего трафика в Интернет.

1. В разделе «Параметры» на панели навигации в левой части страницы NSG-SC900 выберите **Сетевые интерфейсы**.
    1. Выберите **Связать**.
    1. В поле выбора связей сетевого интерфейса щелкните **стрелку раскрывающегося списка**, выберите **sc900-winvmXXX,** а затем нажмите кнопку **ОК** в нижней части окна. После сопоставления интерфейса с NSG этот интерфейс появится в списке.

1. Верните виртуальную машину, выбрав вкладку браузера для виртуальной машины.  Вы увидите, что к интерфейсу виртуальной машины подключена группа безопасности сети.  Отобразится таблица правил портов для входящего трафика. Правила для входящего трафика по умолчанию запрещают весь входящий трафик, который поступает не из виртуальной сети или подсистемы балансировки нагрузки Azure.  Чтобы проверить это, проверка состояние порта RDP 3389.
    1. В верхней части страницы выберите **Подключиться** , а затем выберите **Проверить доступ** для порта 3389 (RDP). Вы увидите сообщение "Недоступно".  
    1. Хотя вы тестируете только порт RDP 3389, весь входящий сетевой трафик, который не из другой виртуальной сети или подсистемы балансировки нагрузки, блокируется.  

1. Теперь вы создадите правило, разрешающее входящий трафик через порт RDP.  В области навигации слева выберите **Сеть**. Должна отобразиться таблица правил для входящих портов (вкладка правил для входящих портов подчеркнута).  В правой части страницы выберите **Добавить правило порта для входящего трафика**. Важно отметить, что нельзя удалить правила по умолчанию, но их можно переопределить, создав правила с более высоким приоритетом. В окне "Добавление правила безопасности входящего трафика" укажите следующие параметры:
    1. Источник:  **Любой**
    1. Диапазоны исходных портов: **\*** .
    1. Место назначения:  **Любой**
    1. Служба:  **RDP**
    1. Действие:  **Разрешить**
    1. Приоритет:  **1000**. Примечание. Правила с более низкими номерами имеют более высокий приоритет и обрабатываются первыми.
    1. Имя: оставьте имя по умолчанию или создайте собственное описательное имя.
    1. Обратите знак предупреждения в нижней части страницы.  Мы используем RDP для только в целях тестирования и для демонстрации функциональности группы безопасности сети.
    1. Нажмите **Добавить**

1. Как только правило будет подготовлено, оно появится в списке правил для входящего трафика (возможно, вам потребуется обновить экран).

### Демонстрация, часть 3.

С помощью группы безопасности сети, связанной с виртуальной машиной, и созданного правила RDP вы увидите влияние NSG, проверив подключение по протоколу RDP к виртуальной машине.

1. Откройте вкладку «SC900-WinVM – Microsoft Azure» в вашем браузере. 

1. Выберите **Подключить** на панели навигации слева.
    1. Вы можете просто выбрать **проверка доступ**.  Состояние должно отображаться как "Доступно". Кроме того, если у вас есть время, вы можете подключиться к виртуальной машине, открыв экземпляр подключения к удаленному рабочему столу в Windows.  Этот параметр откроет виртуальную машину после успешного подключения к ней.  Ниже приведены шаги.
        1. На панели поиска Windows введите **Подключение к удаленному рабочему столу** и нажмите **кнопку Открыть**.
        1. В поле рядом с надписью **Компьютер** введите общедоступный IP-адрес виртуальной машины.
        1. После ввода IP-адреса имя пользователя должно появиться под полем, в котором вы ввели IP-адрес. В противном случае разверните узел **Показать параметры** и введите имя пользователя для виртуальной машины, а затем выберите **Подключиться**.
        1. Открывается окно подключения к удаленному рабочему столу с сообщением, что идентификация удаленного компьютера не может быть проверена. Продолжить в любом случае? Выберите ответ **Да**.
        1. Теперь вы подключены к виртуальной машине. Обратите внимание обучающегося, что в этом случае вы смогли подключиться к виртуальной машине, потому что созданное вами правило входящего трафика пропускает входящий трафик через протокол удаленного рабочего стола.
        1. Сверните виртуальную машину, выбрав символ подчеркивания **_** на синей вкладке, где отображается IP-адрес виртуальной машины. Вы вернетесь на страницу «SC900-WinVM | Подключение».

1. На панели навигации слева выберите **Сеть**, а затем в окне main выберите **Правила исходящего порта**.  Обратитесь к правилам исходящего трафика по умолчанию. Правила по умолчанию разрешают исходящий трафик виртуальной сети из любой виртуальной сети в любую другую виртуальную сеть и разрешают исходящий интернет-трафик. Любой другой тип исходящего трафика отклоняется.  Нельзя удалить правило по умолчанию, но его можно переопределить, создав правило с более высоким приоритетом так же, как и правило для входящего трафика.

1. Если ваш таймер разрешает и вы хотите показать аналогичные шаги для исходящего трафика, перейдите к необязательной демонстрационной части, указанной ниже.  В противном случае выйдите из виртуальной машины, но не закрывайте вкладку Azure в браузере для следующей демонстрации.

### Необязательная демонстрация, часть 4.

В этой части вы увидите текущие правила исходящего трафика NSG, разрешают исходящий интернет-трафик с виртуальной машины.  Затем вы создадите правило для блокировки исходящего интернет-трафика с виртуальной машины. Наконец, вы покажете влияние созданного правила, попытаясь получить доступ к Интернету с виртуальной машины.

1. Откройте виртуальную машину, свернутую на предыдущем шаге. Здесь вы увидите исходящее подключение к Интернету, которое включается одним из правил исходящего трафика по умолчанию. Когда виртуальная машина откроется и вы вошли в систему как пользователь, выберите **Microsoft Edge** , чтобы открыть браузер.  Так как вы открываете Microsoft Edge в первый раз, вы можете во всплывающем окне выбрать **Запустить без данных**, а затем — **Продолжить без этих данных** и после этого — **Подтвердить и начать просмотр**.
    1. Введите **www.bing.com** в адресной строке браузера и убедитесь, что вы можете подключиться к поисковой системе.
    1. Убедившись, что у вас есть доступ к www.bing.com, закройте окно браузера на виртуальной машине, но не отключайте саму виртуальную машину.

1. Сверните виртуальную машину, выбрав символ подчеркивания **_** на синей вкладке, где отображается IP-адрес виртуальной машины. Вы вернетесь на страницу "SC900-WinVM | Подключение".  

1. На панели навигации слева выберите элемент **Сеть**.

1. Перейдите на вкладку **Правила исходящего порта**. Вы увидите правила для исходящего трафика по умолчанию.  Обратите внимание на правило по умолчанию «AllowInternetOutBound». Это правило разрешает весь исходящий интернет-трафик. Вы не можете удалить правило по умолчанию, однако можно переопределить его, создав правило с более высоким приоритетом. В правой части страницы выберите **Добавить правило исходящего порта**.

1. На странице «Добавить правило безопасности исходящего трафика» укажите следующие параметры:
    1. Источник:  **Любой**
    1. Диапазоны исходных портов: **\*** .
    1. Место назначения:  **Тег службы**
    1. Тег службы назначения:  **Интернет**
    1. Служба:  **Пользовательская** (оставьте значение по умолчанию)
    1. Диапазоны портов назначения: * (обязательно поставьте звездочку в поле диапазонов портов назначения)
    1. Протокол: **Любой**
    1. Действие: **Deny**
    1. Приоритет: **1000**
    1. Имя: оставьте имя по умолчанию или создайте собственное описательное имя.
    1. Нажмите **Добавить**

1. После подготовки правила оно появится в списке правил исходящего трафика.  Несмотря на отображение этого правила в списке оно вступит в силу только через несколько минут (подождите несколько минут, прежде чем переходить к дальнейшим действиям).  

1. Вернитесь к виртуальной машине (значок виртуальной машины должен отображаться на панели задач в нижней части страницы).

1. Откройте браузер Microsoft Edge на виртуальной машине и введите **www.bing.com**. Страница не должна отображаться.  Примечание. Если вы можете подключиться к Интернету и проверили, что все параметры для правил исходящего трафика правильно настроены, скорее всего, необходимо подождать несколько минут, чтобы правило вступило в силу.  Закройте браузер, подождите несколько минут и повторите попытку.  Примечание. В подписках Azure в лабораторной среде могут возникать более длительные задержки.

1. Закройте подключение к удаленному рабочему столу, выбрав **X** в центре верхней части страницы, где отображается IP-адрес.  Появляется всплывающее окно с сообщением об отключении удаленного сеанса. Щелкните **ОК**.

1. Не закрывайте вкладку Azure в браузере для следующей демонстрации Azure.

### Просмотр

В рамках этой демонстрации вы изучили сведения и настройки, связанные с группой безопасности сети, включая процедуру привязки интерфейса к группе безопасности сети, продемонстрировали правила для входящего и исходящего трафика по умолчанию, а также действия по созданию нового правила.
