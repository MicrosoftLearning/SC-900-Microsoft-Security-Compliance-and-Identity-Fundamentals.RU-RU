<a name="---"></a><!---
---
Практическое занятие. Заголовок: "Изучение групп безопасности сети Azure (NSG)" Схема обучения/Модуль/Урок: "Схема обучения. Описание возможностей решений безопасности Майкрософт; Модуль 1. Описание основных возможностей обеспечения безопасности в Azure; Урок 6. Описание групп безопасности сети Azure"
---
--->

# <a name="lab-explore-azure-network-security-groups-nsgs"></a>Практическое занятие. Изучение групп безопасности сетей Azure (NSGs)

Это практическое занятие выполняется на основе следующего содержимого Learn:

- Схема обучения. Описание возможностей решений безопасности Майкрософт
- Модуль. Описание основных возможностей обеспечения безопасности в Azure
- Урок. Описание групп безопасности сети Azure

## <a name="lab-scenario"></a>Сценарий практического занятия

В рамках этого практического занятия вы изучите функцию групп безопасности сети в Azure.  Для этого вы создадите группу безопасности сети (NSG) и назначите ее интерфейсу существующей виртуальной машины.  После настройки вы увидите правила для входящего и исходящего трафика по умолчанию, создадите новые правила и протестируете их.  В этом задании виртуальная машина, которую вы будете использовать с NSG, будет создана автоматически, поэтому вы сначала просмотрите некоторые сведения, связанные с ней.
  
**Примерное время**: 30–45 мин.

### <a name="task-1"></a>Задача 1

В этой задаче вы просмотрите некоторые параметры, связанные с виртуальной машиной, созданной автоматически для использования в этом задании.

1. Откройте Microsoft Edge.  В адресной строке введите **portal.azure.com**.

1. Войдите под своими учетными данными администратора.
    1. В окне "Вход" введите имя пользователя, предоставленное поставщиком услуг размещения практических занятий, а затем нажмите кнопку **Далее**.
    1. Введите пароль администратора, который должен быть предоставлен поставщиком услуг размещения практических занятий. Выберите **Войти**.
    1. При появлении предложения не выходить из системы выберите **Да**.

1. В верхней части страницы под надписью "Службы Azure" выберите **Виртуальные машины**.  Если надпись отсутствует, в поле поиска, которое расположено на синей верхней панели рядом с надписью "Microsoft Azure", введите **Виртуальные машины**, затем выберите **Виртуальные машины** в результатах поиска.

1. На странице "Виртуальные машины" выберите **SC900-WinVM**.

1. Вы попадете на страницу SC900-WinVM.  Запишите имя группы ресурсов LabsSC900, в которой находится виртуальная машина.

1. В верхней части страницы выберите **Подключить**, затем в раскрывающемся списке выберите **RDP**. Обратите внимание, что предварительные требования к порту не выполнены.  Чтобы выполнить предварительное требование, необходимо настроить правило безопасности входящей сети с портом назначения 3389, используемым RDP.  Вы сделаете это в следующей задаче, когда будете создавать группу безопасности сети.

1. На панели навигации слева выберите элемент **Сеть**.  
    1. По умолчанию используется представление для правил входящего порта.  Обратите внимание, что в сетевом интерфейсе этой виртуальной машины не настроены группы безопасности сети.  То же справедливо и при выборе правил исходящего порта.
    1. Выберите **Действующие правила безопасности** рядом с пунктом "Сетевой интерфейс".  Обратите внимание, что отображается сообщение "Нет групп безопасности сети или групп безопасности приложений, связанных с сетевым интерфейсом".
1. Не закрывайте эту вкладку браузера.

### <a name="task-2"></a>Задача 2

В этой задаче вы создадите группу безопасности сети, назначите ей сетевой интерфейс виртуальной машины и создадите новое правило для входящего трафика RDP.

1. Откройте вкладку «SC900-WinVM – Microsoft Azure» в вашем браузере.

1. В синей строке поиска в верхней части страницы введите **Группы безопасности сети**. В списке результатов выберите **Группы безопасности сети** (не выбирайте "Классические группы безопасности сети").

1. В верхней части страницы групп безопасности сети выберите **+ Создать**.

1. На вкладке «Основные» страницы «Создание группы безопасности сети» укажите следующие параметры.
    1. Подписка: оставьте значение по умолчанию (это подписка Azure, предоставляемая авторизованным поставщиком услуг размещения практических занятий).
    1. Группа ресурсов.  **LabsSC900**
    1. Имя:  **NSG-SC900**
    1. Регион: оставьте значение по умолчанию.
    1. Выберите **Проверить и создать**, затем выберите **Создать**.

1. По завершении развертывания выберите элемент **Перейти к ресурсу**.

1. В верхней части страницы под надписью "Основное" вы увидите некоторые основные сведения о созданной группе безопасности сети.  Следует отметить два момента: отсутствуют настраиваемые правила безопасности, и отсутствуют подсети и сетевые интерфейсы, связанные с этой группой безопасности сети.  Несмотря на отсутствие настраиваемых правил безопасности, существуют правила для входящего и исходящего трафика по умолчанию, которые включены в каждую группу безопасности сети, как показано на странице.  Просмотрите правила для входящего и исходящего трафика. Правила для входящего трафика по умолчанию запрещают весь входящий трафик, который поступает не из виртуальной сети или подсистемы балансировки нагрузки Azure.  Правила для исходящего трафика запрещают весь исходящий трафик, кроме трафика между виртуальными сетями и исходящего трафика в Интернет.

1. В разделе «Параметры» на панели навигации в левой части страницы NSG-SC900 выберите **Сетевые интерфейсы**.
    1. Выберите **Связать**.
    2. В поле выбора связей сетевого интерфейса щелкните **стрелку вниз**, выберите **sc900-winvmXXX**, а затем нажмите кнопку **ОК** в нижней части окна. После сопоставления интерфейса с NSG этот интерфейс появится в списке.

1. В области навигации слева выберите **Правила безопасности для входящего трафика**.

1. Правила для входящего трафика по умолчанию запрещают весь входящий трафик, не исходящий из виртуальной сети или подсистемы балансировки нагрузки Azure, поэтому необходимо настроить правило, разрешающее входящий трафик RDP (трафик через порт 3389). Помните, что правила по умолчанию нельзя удалить, но их можно переопределить, создавая правила с более высоким приоритетом.

1. В верхней части страницы щелкните **Добавить**. В окне "Добавление правила безопасности входящего трафика" укажите следующие параметры:
    1. Источник:  **Любой**
    1. Диапазоны исходных портов: **\*** .
    1. Место назначения:  **Любой**
    1. Служба:  **RDP**
    1. Действие:  **Разрешить**
    1. Приоритет: **1000**. Примечание. Правила с более низкими номерами имеют более высокий приоритет и обрабатываются первыми.
    1. Имя: оставьте имя по умолчанию или создайте собственное описательное имя.
    1. Обратите внимание на знак предупреждения в нижней части страницы.  Мы используем RDP только в целях тестирования и для демонстрации работы группы безопасности сети.
    1. Нажмите **Добавить**

1. Как только правило будет подготовлено, оно появится в списке правил для входящего трафика (возможно, вам потребуется обновить экран). У добавленного правила вы увидите знак предупреждения.  Как говорилось выше, мы используем RDP только в целях тестирования и для демонстрации работы группы безопасности сети. Выберите только что добавленное правило.

### <a name="task-3"></a>Задача 3

В этой задаче вы протестируете только что созданное правило NSG для входящего трафика, чтобы убедиться в возможности установить подключение к виртуальной машине через удаленный рабочий стол (RDP).  В виртуальной машине вы сможете проверить исходящее подключение к Интернету с виртуальной машины.

1. Откройте вкладку «SC900-WinVM – Microsoft Azure» в вашем браузере. Если вы ранее закрыли вкладку браузера, щелкните синюю панель поиска в верхней части страницы и выберите "Виртуальные машины", а затем — виртуальную машину **SC900-WinVM**.

1. В верхней части страницы выберите **Подключиться**, а затем — **RDP**.

1. Убедитесь, что задан общедоступный IP-адрес, оставьте номер порта по умолчанию и выберите **Загрузить DRP-файл**.

1. Во всплывающем окне выберите **Открыть файл**.

1. Откроется окно "Подключение к удаленному рабочему столу". Выберите в нем команду **Подключиться**.

1. Вам будет предложено ввести свои учетные данные.  Введите имя пользователя и пароль (см. вкладку ресурсов на панели инструкций к заданию).

1. Открывается окно подключения к удаленному рабочему столу с сообщением, что идентификация удаленного компьютера не может быть проверена.  Продолжить в любом случае?  Выберите ответ **Да**.

1. Теперь вы подключены к виртуальной машине. В этом случае вы смогли подключиться к ВМ, потому что созданное вами правило входящего трафика пропускает входящий трафик к ВМ через RDP.

1. Через несколько секунд на экране приветствия появится окно выбора параметров конфиденциальности для устройства. Нажмите кнопку **Принять**.  В окне "Сети" выберите **Нет**.

1. После запуска виртуальной машины проверьте исходящее подключение с нее к Интернету.
    1. На виртуальной машине выберите **Microsoft Edge**, чтобы открыть браузер.  Так как вы открываете Microsoft Edge в первый раз, вы можете во всплывающем окне выбрать **Запустить без данных**, затем — **Продолжить без этих данных**, а после этого — **Подтвердить и начать просмотр**.
    1. Введите **www.bing.com** в адресной строке браузера и убедитесь в том, что вы можете подключиться к поисковой системе.
    1. Убедившись в наличии доступа к www.bing.com, закройте окно браузера на виртуальной машине, но не отключайте саму виртуальную машину.

1. Сверните виртуальную машину, выбрав символ подчеркивания **_** на синей вкладке, где отображается IP-адрес виртуальной машины. Вы вернетесь на страницу "SC900-WinVM | Подключение". 

1. На панели навигации слева выберите элемент **Сеть**.

1. Не закрывайте вкладку браузера, так как она будет использоваться в следующей задаче.

### <a name="task-4"></a>Задача 4.

В предыдущей задаче вы подтвердили, что можно установить RDP-подключение к виртуальной машине. После входа в виртуальную машину вы также подтвердили, что можете установить исходящее подключение к Интернету.  Исходящий интернет-трафик был разрешен, так как правила для исходящего трафика по умолчанию для NSG разрешают его.  В этой задаче вы создадите пользовательское правило исходящего трафика для блокировки исходящего трафика в Интернет и проверите это правило.

1. Вы должны быть на странице "SC900-WinVM | Сеть". Если вы ранее закрыли вкладку браузера, щелкните синюю панель поиска в верхней части страницы и выберите "Виртуальные машины", затем — виртуальную машину **SC900-WinVM**, а после этого — пункт **Сеть**.

1. Перейдите на вкладку **Правила исходящего порта**. Вы увидите правила для исходящего трафика по умолчанию.  Обратите внимание на правило по умолчанию «AllowInternetOutBound». Это правило разрешает весь исходящий интернет-трафик. Вы не можете удалить правило по умолчанию, однако можно переопределить его, создав правило с более высоким приоритетом. В правой части страницы выберите **Добавить правило исходящего порта**.

1. На странице «Добавить правило безопасности исходящего трафика» укажите следующие параметры:
    1. Источник:  **Любой**
    1. Диапазоны исходных портов: **\*** .
    1. Место назначения:  **Тег службы**
    1. Тег службы назначения:  **Интернет**
    1. Служба:  **Пользовательская** (оставьте значение по умолчанию)
    1. Диапазоны портов назначения: * (обязательно поставьте звездочку в поле диапазонов портов назначения)
    1. Протокол: **Любой**
    1. Действие: **Deny**
    1. Приоритет: **1000**
    1. Имя: оставьте имя по умолчанию или создайте собственное описательное имя.
    1. Нажмите **Добавить**

1. После подготовки правила оно появится в списке правил исходящего трафика.  Несмотря на отображение этого правила в списке оно вступит в силу только через несколько минут (подождите несколько минут, прежде чем переходить к дальнейшим действиям).  

1. Вернитесь к виртуальной машине (значок виртуальной машины должен отображаться на панели задач в нижней части страницы).

1. Откройте браузер Microsoft Edge на виртуальной машине и введите **www.bing.com**. Страница не должна отображаться.  Примечание. Если вы можете подключиться к Интернету и убедились в том, что все параметры для правил исходящего трафика правильно настроены, скорее всего, необходимо подождать несколько минут, чтобы правило вступило в силу.  Закройте браузер, подождите несколько минут и повторите попытку.  Примечание. В подписках Azure в лабораторной среде могут возникать более длительные задержки.

1. Закройте подключение к удаленному рабочему столу, выбрав **X** в центре верхней части страницы, где отображается IP-адрес.  Появляется всплывающее окно с сообщением об отключении удаленного сеанса. Щелкните **ОК**.

1. Закройте все открытые вкладки браузера.

### <a name="review"></a>Просмотр

В этой лаборатории показано, как настроить группу безопасности сети (NSG), связать ее с сетевым интерфейсом виртуальной машины и добавить в нее новые правила, чтобы разрешить входящий трафик RDP и заблокировать исходящий интернет-трафик.
